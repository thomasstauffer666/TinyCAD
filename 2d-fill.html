<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Point Plotter</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        canvas {
            border: 1px solid #ccc;
            cursor: crosshair;
        }

        #pointsData {
            font-family: monospace;
            border: 1px solid #eee;
            width: 800px;
        }
    </style>
</head>

<body>
    <canvas id="canvas" width="800" height="600"></canvas>

    <div>
        <button id="clear">Clear</button>
        <input type="range" id="distanceSlider" min="1" max="300">
        <span id="distanceValue">50</span>
        <div id="pointsData"></div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const pointsData = document.getElementById('pointsData');
        const distanceSlider = document.getElementById('distanceSlider');
        const distanceValue = document.getElementById('distanceValue');

        let points = [];
        let currentDistance = 150;

        points = [{ "x": 223, "y": 156 }, { "x": 313, "y": 144 }, { "x": 439, "y": 119 }, { "x": 581, "y": 189 }, { "x": 617, "y": 316 }, { "x": 542, "y": 483 }, { "x": 457, "y": 537 }, { "x": 340, "y": 536 }, { "x": 260, "y": 522 }, { "x": 285, "y": 459 }, { "x": 339, "y": 465 }, { "x": 423, "y": 442 }, { "x": 451, "y": 401 }, { "x": 447, "y": 315 }, { "x": 408, "y": 252 }, { "x": 292, "y": 242 }, { "x": 241, "y": 196 }, { "x": 512, "y": 177 }, { "x": 588, "y": 373 }];

        function drawPoint(p) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#cc00ff';
            ctx.fill();
            ctx.strokeStyle = '#660099';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        function drawPolygon(points) {
            if (points.length == 0) {
                return;
            }
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.closePath();
            ctx.fillStyle = '#eeccff';
            ctx.fill();
        }

        function distance(p1, p2) {
            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;
            return Math.sqrt((dx * dx) + (dy * dy));
        }

        function closeTo(p, points, maxDistance) {
            return points.filter(point => {
                if (point === p) {
                    return false;
                }
                return distance(p, point) <= maxDistance;
            });
        }

        // Monotone Chain Algorithm
        function convexHull(points) {
            const sorted = points.toSorted((a, b) => (a.x - b.x) || (a.y - b.y));

            const buildHull = (pointSubset) => pointSubset.reduce((hull, p) => {
                while ((hull.length >= 2) && (cross(hull[hull.length - 2], hull[hull.length - 1], p) <= 0.0)) {
                    hull.pop();
                }
                return [...hull, p];
            }, []);

            const lower = buildHull(sorted);
            const upper = buildHull(sorted.toReversed());
            return [...lower.slice(1), ...upper.slice(1)];
        }

        function cross(o, a, b) {
            return ((a.x - o.x) * (b.y - o.y)) - ((a.y - o.y) * (b.x - o.x));
        }

        function redraw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            points.forEach(p => {
                const close = closeTo(p, points, currentDistance);
                const forHull = [p, ...close];
                const hull = convexHull(forHull);
                drawPolygon(hull);
            });

            points.forEach(point => {
                drawPoint(point);
            });

            pointsData.textContent = JSON.stringify(points);
            distanceValue.textContent = currentDistance;
        }

        canvas.addEventListener('click', function (event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            points.push({ x: Math.round(x), y: Math.round(y) });
            redraw();
        });

        distanceSlider.value = currentDistance;
        distanceSlider.addEventListener('input', function () {
            currentDistance = parseInt(this.value);
            redraw();
        });

        document.getElementById('clear').addEventListener('click', function () {
            points = [];
            redraw();
        });

        redraw();
    </script>
</body>

</html>